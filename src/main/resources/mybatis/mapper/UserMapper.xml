<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ts.cpfr.dao.UserDao">
	<select id="selectUserByName" parameterType="pd" resultType="com.ts.cpfr.entity.LoginUser">
        select admin_id,wid,name,password from tbl_user where name=#{name}
    </select>

	<update id="insertAdminUser" parameterType="pd">
		INSERT INTO tbl_user(name,password,permission_level,register_time) VALUES(#{name},#{password},0,now());
		UPDATE tbl_user SET wid = (SELECT LAST_INSERT_ID())  WHERE admin_id =(SELECT LAST_INSERT_ID());
	</update>

	<select id="selectWidByAdminId" parameterType="String" resultType="int">
		select wid from tbl_user where admin_id=#{wid}
	</select>

	<update id="updateUserLoginTime" parameterType="pd">
		update tbl_user set last_login_time=now() where admin_id=#{admin_id}
	</update>

	<update id="updateUserPassword" parameterType="pd">
		update tbl_user set password=#{new_password} where admin_id=#{admin_id}
	</update>
</mapper>