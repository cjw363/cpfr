<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ts.cpfr.dao.PersonDao">
	<select id="selectPerson" parameterType="pd" resultType="pd">
		SELECT p.person_id,p.person_name,p.emp_number,p.add_time,i.blob_image base_image from tbl_#{wid}_person  p left join tbl_#{wid}_image i on p.image_id=i.image_id where person_id=#{person_id}
	</select>

	<select id="selectPersonList" parameterType="pd" resultType="pd">
		select person_id,person_name,emp_number,add_time,image_id from tbl_#{wid}_person
		<where>
			<if test="group_id!=null and group_id!=''">
				group_id=#{group_id}
			</if>
		</where>
	</select>

	<select id="selectPersonListWithBlob" parameterType="pd" resultType="pd">
		select p.person_id,p.person_name,p.emp_number,p.add_time,i.blob_image base_image from tbl_#{wid}_person p left join tbl_#{wid}_image i on p.image_id=i.image_id
		<where>
			<if test="group_id!=null and group_id!=''">
				p.group_id=#{group_id}
			</if>
		</where>
	</select>

	<insert id="insertPerson" parameterType="pd">
		INSERT INTO tbl_#{wid}_person(person_name,emp_number,add_time,image_id) VALUES(#{person_name},#{emp_number},now(),(select LAST_INSERT_ID()))
	</insert>

	<update id="updatePersonGroupID" parameterType="pd">
		UPDATE tbl_#{wid}_person SET group_id = #{group_id}  WHERE
		<foreach collection="list" item="data" separator=" or ">
			person_id=#{data.person_id}
		</foreach>
	</update>

	<select id="selectImage" parameterType="pd" resultType="pd">
		SELECT blob_image FROM tbl_#{wid}_image WHERE image_id=#{image_id}
	</select>

	<insert id="insertImage" parameterType="pd">
		insert into tbl_#{wid}_image (blob_image) values (#{blob_image})
	</insert>
</mapper>